import os
import sys
import gym
from gym import wrappers
import malware_rl

from IPython import embed

module_path = os.path.split(os.path.abspath(sys.modules[__name__].__file__))[0]


class RandomAgent(object):
    """The world's simplest agent!"""
    def __init__(self, action_space):
        self.action_space = action_space

    def act(self, observation, reward, done):
        return self.action_space.sample()

env = gym.make('ember-train-v0')
outdir = os.path.join(module_path, 'data/logs/random-agent-results')
env = wrappers.Monitor(env, directory=outdir, force=True)
env.seed(0)
agent = RandomAgent(env.action_space)
episode_count = 250
reward = 0
evasions = 0
done = False

for i in range(episode_count):
    ob = env.reset()
    while True:
        action = agent.act(ob, reward, done)
        ob, reward, done, _ = env.step(action)
        if done and reward >= 10.0:
            evasions +=1
            break
        elif done:
            break

evasion_rate = (evasions/episode_count)*100
print(f"{evasions}% samples evaded model...")
embed()